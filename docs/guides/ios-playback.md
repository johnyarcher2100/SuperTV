# 📱 iOS 播放指南

## 問題診斷

如果您在 iPhone 上看到「播放錯誤：Video format not supported by browser」，這是因為：

1. **視頻格式不相容** - 某些直播源使用的編碼格式不被 iOS Safari 支援
2. **網路連接問題** - HTTPS 環境下無法訪問 HTTP 串流（混合內容問題）
3. **CORS 限制** - 跨域資源共享限制

## ✅ 已實施的修復

### 1. iOS 原生 HLS 支援優化
- ✅ 自動檢測 iOS 設備
- ✅ 優先使用 iOS Safari 原生 HLS 播放器
- ✅ 直接設置 `video.src` 而非使用 `<source>` 元素
- ✅ 添加 `playsinline` 和 `webkit-playsinline` 屬性

### 2. 改善的錯誤處理
- ✅ iOS 專用的友善錯誤訊息
- ✅ 自動重試機制（最多 3 次）
- ✅ 重試按鈕讓用戶手動重試
- ✅ 詳細的錯誤日誌供調試

### 3. 多播放引擎支援
- ✅ iOS: 原生 HLS 播放器（優先）
- ✅ 桌面: HLS.js（優先）
- ✅ 自動降級到備用播放器

## 🎯 推薦的直播源（iOS 相容性最佳）

### ⭐ 最佳選擇
1. **秒開直播源** - 專為移動設備優化
2. **Judy 直播源** - 穩定且相容性好
3. **Gather 直播源** - 多種格式支援

### ⚠️ 避免使用
- **黃金直播源** - 在 HTTPS 環境下無法在 iOS 上使用（私有伺服器問題）

## 📋 測試步驟

### 1. 基本測試
```
1. 在 iPhone Safari 中打開應用
2. 選擇「秒開直播源」
3. 等待頻道列表載入
4. 點擊任一頻道（建議：新聞類頻道）
5. 觀察是否正常播放
```

### 2. 如果出現錯誤
```
1. 點擊「重試」按鈕
2. 如果仍然失敗，嘗試其他頻道
3. 如果所有頻道都失敗，切換到其他直播源
4. 檢查網路連接是否穩定
```

### 3. 檢查瀏覽器控制台
```
1. 在 Safari 中啟用開發者模式
2. 連接到 Mac 的 Safari
3. 查看控制台日誌
4. 尋找以下關鍵訊息：
   - "IPTV Player: Using native HLS player (iOS)"
   - "IPTV Player: Loading native HLS with URL:"
   - 任何錯誤訊息
```

## 🔧 常見問題解決

### 問題 1: 所有頻道都無法播放
**可能原因：**
- 網路連接不穩定
- 直播源伺服器暫時無法訪問
- iOS 版本過舊

**解決方案：**
1. 檢查 Wi-Fi 連接
2. 嘗試切換到其他直播源
3. 更新 iOS 到最新版本
4. 重新啟動 Safari

### 問題 2: 部分頻道可以播放，部分不行
**可能原因：**
- 某些頻道使用不相容的編碼格式
- 某些頻道的伺服器有地區限制

**解決方案：**
1. 這是正常現象
2. 使用可以播放的頻道
3. 嘗試其他直播源中的相同頻道

### 問題 3: 視頻載入很慢
**可能原因：**
- 網路速度慢
- 伺服器響應慢
- 視頻品質過高

**解決方案：**
1. 等待緩衝完成
2. 切換到網路狀況更好的環境
3. 嘗試其他直播源

### 問題 4: 視頻有聲音但沒有畫面
**可能原因：**
- 視頻渲染問題
- 編碼格式部分不相容

**解決方案：**
1. 點擊「重試」按鈕
2. 切換到其他頻道再切換回來
3. 重新整理頁面

## 🚀 性能優化建議

### 1. 網路環境
- ✅ 使用穩定的 Wi-Fi 連接
- ✅ 確保網速至少 5 Mbps
- ❌ 避免使用不穩定的公共 Wi-Fi

### 2. 設備設定
- ✅ 關閉省電模式（可能限制視頻播放）
- ✅ 確保 Safari 有足夠的權限
- ✅ 清除 Safari 緩存（如果遇到問題）

### 3. 使用習慣
- ✅ 優先選擇推薦的直播源
- ✅ 如果頻道無法播放，立即切換
- ✅ 定期重新整理頁面以獲得最佳性能

## 📊 技術細節

### iOS Safari 支援的視頻格式
- ✅ HLS (HTTP Live Streaming) - .m3u8
- ✅ MP4 (H.264 + AAC)
- ✅ MOV (QuickTime)
- ❌ WebM (部分支援)
- ❌ OGG (不支援)

### 播放器選擇邏輯
```javascript
iOS 設備:
  1. 嘗試原生 HLS 播放器
  2. 如果失敗，嘗試原生串流播放器
  3. 如果仍失敗，顯示錯誤訊息

桌面瀏覽器:
  1. 嘗試 HLS.js
  2. 如果失敗，嘗試原生播放器
  3. 如果仍失敗，顯示錯誤訊息
```

### 錯誤代碼說明
- **Code 1**: 視頻載入被中止
- **Code 2**: 網路錯誤
- **Code 3**: 視頻解碼失敗
- **Code 4**: 視頻格式不支援 ⚠️ 最常見

## 🔍 調試技巧

### 啟用詳細日誌
打開 Safari 開發者工具，查看控制台輸出：

```
✅ 成功的日誌：
- "IPTV Player: Using native HLS player (iOS)"
- "IPTV Player: Metadata loaded for native HLS"
- "✅ IPTV Player: Automatic playback started successfully"

❌ 錯誤的日誌：
- "IPTV Player: Loading method X failed"
- "IPTV Player: All loading methods failed"
- "Video format not supported"
```

### 測試特定 URL
如果您想測試特定的串流 URL：

1. 點擊「自訂來源」
2. 選擇「直接播放網址」
3. 輸入測試 URL
4. 觀察播放結果

## 📞 獲取幫助

如果問題仍然存在：

1. **記錄錯誤訊息** - 截圖或複製完整的錯誤訊息
2. **記錄環境資訊**:
   - iOS 版本
   - Safari 版本
   - 使用的直播源
   - 嘗試播放的頻道名稱
3. **檢查控制台日誌** - 提供詳細的錯誤日誌

## 🎉 成功指標

您應該能夠：
- ✅ 載入直播源（5-10 秒內）
- ✅ 看到頻道列表
- ✅ 點擊頻道後開始播放（10-15 秒內）
- ✅ 聽到聲音並看到畫面
- ✅ 使用播放控制（播放/暫停/音量）
- ✅ 切換到其他頻道

---

**最後更新**: 2025-10-31
**版本**: 1.0
**適用於**: iOS 14+ / Safari 14+

